---
title: "Analiza metod DMR"
author: "A.Brodecka"
output:
   html_document:
     highlight: espresso
     keep_md: yes
     number_sections: yes
     theme: flatly
     toc: yes
     toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE)
```

```{r, echo = FALSE, include= FALSE}

source('/home/abrodecka/Pulpit/met/metR/Rcodes/function_preprocessing.R')
source('/home/abrodecka/Pulpit/met/metR/Rcodes/libraries.R')
options(scipen=10000)
library(gplots)

```

# Opis sposobu symulacji

### Metoda 1:


Metoda, która ma za zadanie odtworzyć naturalny rozk?ad danych. Przebiega identycznie i niezaleźnie dla każdej z badanych grup:

	1. Z każdej pozycji chromosomu $t$ i próbki $j$ pobrana zostaje informacja o stopniu metylacji $met_{tj}$
	
	2. Następnie, dla każdej pozycji została wylosowana liczba cytozyn, kt?re uległy metylacji $C_{tj}$ zgodnie z rozkładem Bernoulliego $\sim Bern(met_{tj}, COV_{tj})$ Prawdopodobieństwo sukcesu w tym rozkładzie było równe stopniu metylacji a liczba zdarzeń stanowiła sumę 
	liczb zmetylowanych i niezmetylowanych cytozyn - $COV_{tj}$
	
	* Zgodnie z powyższym liczba sukcesów b?dzie wskazywała na liczbę zmetylowanych cytozyn a różnica między liczbą zdarzeń a liczbą sukcesów na liczbę cytozyn, które nie uległy metylacji
		

### Metoda 2.

Powyższa metoda zakłada, że 5% analizowanych regionów jest różnorodnie zmetylowana, natomiast pozosta?e 95% regionów nie wykazuje różnic w stopniu metylacji. Symulacje odbywają się jednocześnie dla obu grup w następujący sposób: 


	* Próbka została podzielona na regiony o d?ugo?ci 1000bps. Z każdego 
	regionu został pobrany średni stopień metylacji w obu grupach ($met_{r}$)
	
	*  Kolejno, losowo podzielono wszystkie regiony na grupy o liczności 95% (grupa 1.) i 5% (grupa 2.) 
	
	*  Losowanie liczby zmetylowanych cytozyn - $C_{tj}$ również odbywało się zgodnie z rozkładem Bernoulliego. W grupie 1., dla obu próbek:  $ Bern(met_{r}, COV_{tj})$. Natomiast w grupie 2., pierwsza próbka została wylosowana zgodnie z rozkładem: $ Bern(met_{r}, COV_{1j})$
	natomiast druga z: $Bern(met_{r} + p, COV_{2j})$
	, gdzie $p$ to dodatkowy parametr mówiący o różnicy metylacji w obu próbkach.
	
* R?wnie? w tej metodzie liczba sukces?w w rozk?adzie Bernoulliego b?dzie wskazywa?a na liczb? zmetylowanych cytozyn a r??nica mi?dzy liczb? zdarze? a liczb? sukces?w na liczb? cytozyn, kt?re nie uleg?y metylacji
	


W obu metodach zachowano rzeczywistą wartość pokrycia. Zmianie uległ jedynie stopień metylacji. 





# Metoda 1.

```{r}

sym <- readRDS('/home/abrodecka/Pulpit/met/summary_pr_1.rds')

print(paste0("Ilosc regionów: ", nrow(sym)))


ggplot(sym, aes(met_n_EK)) + geom_histogram(binwidth = 5) + ggtitle('Rozkład pokrycia regionów')  +
  theme_minimal() + xlim(0,150) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Stopień pokrycia",y="Częstość")

ggplot(sym, aes(met_diff)) + geom_histogram(binwidth = 0.01) + ggtitle('Rozkład różnicy metylacji')  +
  theme_minimal() + xlim(0,0.5) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Różnica metlacji",y="Częstość")
```


### tTest:

```{r}
r <- readRDS('/home/abrodecka/Pulpit/met/tTest_pr_1.rds')

print(paste0('Ile braków danych: ', r %>% filter(is.na(pValue)) %>% nrow()))

#select(-c(no_prob, tiles)) %>%
r %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> r

DT::datatable(r[1:100, -c(1,2,3,5)])

```


### Wilcoxon:

```{r}
w <- readRDS('/home/abrodecka/Pulpit/met/Wilcoxon_pr_1.rds')

print(paste0('Ile braków danych: ', w %>% filter(is.na(pValue)) %>% nrow()))


w %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> w

DT::datatable(w[1:100,-c(1,2,3,5) ])

```

### KStest

```{r}
k <- readRDS('/home/abrodecka/Pulpit/met/KS_pr_1.rds')

print(paste0('Ile braków danych: ', k %>% filter(is.na(pValue)) %>% nrow()))


k %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> k

DT::datatable(k[1:100, -c(1,2,3,5)])

```


### Regresja logistyczna:

```{r}
l <- readRDS('/home/abrodecka/Pulpit/met/Log_reg_pr_1.rds')

print(paste0('Ile braków danych: ', l %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
l %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> l1

DT::datatable(l1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

l %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> l2

DT::datatable(l2[1:100, -c(1,2,3,6)])
```


### Regresja logistyczna z efektami losowymi:

```{r}
m <- readRDS('/home/abrodecka/Pulpit/met/Mixed_reg_pr_1.rds')

print(paste0('Ile braków danych: ', m %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
m %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> m1

DT::datatable(m1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

m %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> m2

DT::datatable(m2[1:100, -c(1,2,3,6)])
```



### Regresja logistyczna z efektami losowymi z uwzgl?dnieniem korelacji:

```{r}
c <- readRDS('/home/abrodecka/Pulpit/met/Corr_reg_pr_1.rds')

print(paste0('Ile braków danych: ', c %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
c %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> c1

DT::datatable(c1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

c %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> c2

DT::datatable(c2[1:100, -c(1,2,3,6)])
```



### Podsumowanie:

#### Diagramy Venna:

```{r}

venn(list(Ttest=r$prob_name,Wilc=w$prob_name, Log2 = l2$prob_name, Mix2 = m2$prob_name, Corr2 = c2$prob_name))
venn(list(Mix1 = m1$prob_name, Mix2 = m2$prob_name))
venn(list(Corr1 = c1$prob_name, Corr2 = c2$prob_name))
venn(list(Log1=l1$prob_name,Log2 = l2$prob_name))
venn(list(Ttest=r$prob_name,Wilc=w$prob_name,KS=k$prob_name))
```

### Rozkłady top 1000 każdej z metod

```{r}
data_plot = data.frame(type = rep(c('Ttest','Wilc','KS','Log1','Log2', 'Mix1', 'Mix2','Corr1', 'Corr2'), each =999), q = c(r$quantile,w$quantile,k$quantile,l1$quantile,
           l2$quantile,  m1$quantile,  m2$quantile, c1$quantile,  c2$quantile),
           n = c(r$met_n_EK,w$met_n_EK,k$met_n_EK,l1$met_n_EK,
           l2$met_n_EK,  m1$met_n_EK,  m2$met_n_EK, c1$met_n_EK,  c2$met_n_EK),
           sd_EK = c(r$met_sd_EK,w$met_sd_EK,k$met_sd_EK,l1$met_sd_EK,
           l2$met_sd_EK,  m1$met_sd_EK,  m2$met_sd_EK, c1$met_sd_EK,  c2$met_sd_EK))



ggplot(data_plot, aes(x = type, y=n)) + 
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład pokrycia względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Pokrycie regionu")


ggplot(data_plot, aes(x = type, y=q)) + 
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład kwantyli względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Wartość kwantyli")

```

# Metoda 2.

## p = 0.02

```{r}
sym <- readRDS('/home/abrodecka/Pulpit/met/summary_pr_3_0.02.rds')
print(paste0("Ilosc regionów: ", nrow(sym)))

sym$type <- sym$type

ggplot(sym, aes(met_n_EK, group = type, fill=type)) + geom_histogram(bindwidth = 5) + ggtitle('Rozkład pokrycia regionów')  +
  theme_minimal() + xlim(0,150) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Stopień pokrycia",y="Częstość")


 ggplot(sym, aes(met_diff, group = type, fill=type)) + geom_histogram(binwidth = 0.01) + ggtitle('Rozkład różnicy metylacji')  +
  theme_minimal() + xlim(0,0.5) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Różnica metlacji",y="Częstość")


```



### tTest:

```{r}
r <- readRDS('/home/abrodecka/Pulpit/met/tTest_pr_3_0.02.rds')

print(paste0('Ile brak?w danych: ', r %>% filter(is.na(pValue)) %>% nrow()))


r %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> r

DT::datatable(r[1:100, -c(1,2,3,5)])

```



### Wilcoxon:

```{r}
w <- readRDS('/home/abrodecka/Pulpit/met/Wilcoxon_pr_3_0.02.rds')

print(paste0('Ile braków danych: ', w %>% filter(is.na(pValue)) %>% nrow()))


w %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> w

DT::datatable(w[1:100, -c(1,2,3,5)])

```



### KSTest:

```{r}
k <- readRDS('/home/abrodecka/Pulpit/met/KS_pr_3_0.02.rds')

print(paste0('Ile braków danych: ', k %>% filter(is.na(pValue)) %>% nrow()))


k %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> k

DT::datatable(k[1:100, -c(1,2,3,5)])


```



### Regresja logistyczna:

```{r}
l <- readRDS('/home/abrodecka/Pulpit/met/Log_reg_pr_3_0.02.rds')
print(paste0('Ile braków danych: ', l %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
l %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
 left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> l1


DT::datatable(l1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

l %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> l2


DT::datatable(l2[1:100, -c(1,2,3,6)])
```




### Regresja logistyczna z efektami losowymi:

```{r}
m <- readRDS('/home/abrodecka/Pulpit/met/Mixed_reg_pr_3_0.02.rds')

print(paste0('Ile braków danych: ', m %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
m %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> m1

DT::datatable(m1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

m %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> m2

DT::datatable(m2[1:100, -c(1,2,3,6)])
```



### Regresja logistyczna z efektami losowymi z uwzględnieniem korelacji:

```{r}
c <- readRDS('/home/abrodecka/Pulpit/met/Corr_reg_pr_3_0.02.rds')

print(paste0('Ile braków danych: ', c %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
c %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> c1

DT::datatable(c1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

c %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> c2

DT::datatable(c2[1:100, -c(1,2,3,6)])
```


### Podsumowanie:

#### Diagramy Venna:

```{r}

venn(list(Ttest=r$prob_name,Wilc=w$prob_name, Log2 = l2$prob_name, Mix2 = m2$prob_name, Corr2 = c2$prob_name))
venn(list(Mix1 = m1$prob_name, Mix2 = m2$prob_name))
venn(list(Corr1 = c1$prob_name, Corr2 = c2$prob_name))
venn(list(Log1=l1$prob_name,Log2 = l2$prob_name))
venn(list(Ttest=r$prob_name,Wilc=w$prob_name,KS=k$prob_name))
```

### Rozkłady top 1000 każdej z metod

```{r}

min_n = min(c(nrow(r), nrow(w), nrow(k), nrow(l1), nrow(l2), nrow(m1), nrow(m2), nrow(c1), nrow(c2)))
data_plot = data.frame(type = rep(c('Ttest','Wilc','KS','Log1','Log2', 'Mix1', 'Mix2','Corr1', 'Corr2'), each =min_n), q = c(r$quantile[1:min_n],w$quantile[1:min_n],k$quantile[1:min_n],l1$quantile[1:min_n],
           l2$quantile[1:min_n],  m1$quantile[1:min_n],  m2$quantile[1:min_n], c1$quantile[1:min_n],  c2$quantile[1:min_n]),
           n = c(r$met_n_EK[1:min_n] , w$met_n_EK[1:min_n] , k$met_n_EK[1:min_n] , l1$met_n_EK[1:min_n] ,
           l2$met_n_EK[1:min_n] ,  m1$met_n_EK[1:min_n] ,  m2$met_n_EK[1:min_n] , c1$met_n_EK[1:min_n],  c2$met_n_EK[1:min_n]),
           sd_EK = c(r$met_sd_EK[1:min_n] , w$met_sd_EK[1:min_n] ,k$met_sd_EK[1:min_n] ,l1$met_sd_EK[1:min_n] ,
           l2$met_sd_EK[1:min_n] ,  m1$met_sd_EK[1:min_n],  m2$met_sd_EK[1:min_n], c1$met_sd_EK[1:min_n],  c2$met_sd_EK[1:min_n]))

ggplot(data_plot, aes(x = type, y=n)) + 
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład pokrycia względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Pokrycie regionu")


ggplot(data_plot, aes(x = type, y=q)) + 
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład kwantyli względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Wartość kwantyli")

```


## p = 0.04

```{r}
sym <- readRDS('/home/abrodecka/Pulpit/met/summary_pr_3_0.04.rds')
print(paste0("Ilosc regionów: ", nrow(sym)))

sym$type <- sym$type

ggplot(sym, aes(met_n_EK, group = type, fill=type)) + geom_histogram(bindwidth = 5) + ggtitle('Rozkład pokrycia regionów')  +
  theme_minimal() + xlim(0,150) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Stopień pokrycia",y="Częstość")


 ggplot(sym, aes(met_diff, group = type, fill=type)) + geom_histogram(binwidth = 0.01) + ggtitle('Rozkład różnicy metylacji')  +
  theme_minimal() + xlim(0,0.5) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="R??nica metlacji",y="Częstość")


```



### tTest:

```{r}
r <- readRDS('/home/abrodecka/Pulpit/met/tTest_pr_3_0.04.rds')

print(paste0('Ile brak?w danych: ', r %>% filter(is.na(pValue)) %>% nrow()))


r %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> r


DT::datatable(r[1:100, -c(1,2,3,5)])

```



### Wilcoxon:

```{r}
w <- readRDS('/home/abrodecka/Pulpit/met/Wilcoxon_pr_3_0.04.rds')

print(paste0('Ile brak?w danych: ', w %>% filter(is.na(pValue)) %>% nrow()))


w %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> w

DT::datatable(w[1:100, -c(1,2,3,5)])

```



### KSTest:

```{r}
k <- readRDS('/home/abrodecka/Pulpit/met/KS_pr_3_0.04.rds')

print(paste0('Ile brak?w danych: ', k %>% filter(is.na(pValue)) %>% nrow()))


k %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> k


DT::datatable(k[1:100, -c(1,2,3,5)])


```



### Regresja logistyczna:

```{r}
l <- readRDS('/home/abrodecka/Pulpit/met/Log_reg_pr_3_0.04.rds')

print(paste0('Ile braków danych: ', l %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
l %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> l1

DT::datatable(l1[1:100, -c(1,2,3,6)])

```

Szeregowane po beta:

```{r}

l %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> l2

DT::datatable(l2[1:100, -c(1,2,3,6)])

```


### Regresja logistyczna z efektami losowymi:

```{r}
m <- readRDS('/home/abrodecka/Pulpit/met/Mixed_reg_pr_3_0.04.rds')

print(paste0('Ile braków danych: ', m %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
m %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> m1

DT::datatable(m1[1:100, -c(1,2,3,6)])

```

Szeregowane po beta:

```{r}

m %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> m2

DT::datatable(m2[1:100, -c(1,2,3,6)])

```


### Regresja logistyczna z efektami losowymi z uwzględnieniem korelacji:

```{r}
c <- readRDS('/home/abrodecka/Pulpit/met/Corr_reg_pr_3_0.04.rds')

print(paste0('Ile braków danych: ', c %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
c %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
 left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> c1

DT::datatable(c1[1:100, -c(1,2,3,6)])

```

Szeregowane po beta:

```{r}

c %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
 left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> c2

DT::datatable(c2[1:100, -c(1,2,3,6)])

```


### Podsumowanie

```{r}

venn(list(Ttest=r$prob_name,Wilc=w$prob_name, Log2 = l2$prob_name, Mix2 = m2$prob_name, Corr2 = c2$prob_name))
venn(list(Mix1 = m1$prob_name, Mix2 = m2$prob_name))
venn(list(Corr1 = c1$prob_name, Corr2 = c2$prob_name))
venn(list(Log1=l1$prob_name,Log2 = l2$prob_name))
venn(list(Ttest=r$prob_name,Wilc=w$prob_name,KS=k$prob_name))
```

### Rozk?ady top 1000 każdej z metod

```{r}
min_n = min(c(nrow(r), nrow(w), nrow(k), nrow(l1), nrow(l2), nrow(m1), nrow(m2), nrow(c1), nrow(c2)))
data_plot = data.frame(type = rep(c('Ttest','Wilc','KS','Log1','Log2', 'Mix1', 'Mix2','Corr1', 'Corr2'), each =min_n), q = c(r$quantile[1:min_n],w$quantile[1:min_n],k$quantile[1:min_n],l1$quantile[1:min_n],
           l2$quantile[1:min_n],  m1$quantile[1:min_n],  m2$quantile[1:min_n], c1$quantile[1:min_n],  c2$quantile[1:min_n]),
           n = c(r$met_n_EK[1:min_n] , w$met_n_EK[1:min_n] , k$met_n_EK[1:min_n] , l1$met_n_EK[1:min_n] ,
           l2$met_n_EK[1:min_n] ,  m1$met_n_EK[1:min_n] ,  m2$met_n_EK[1:min_n] , c1$met_n_EK[1:min_n],  c2$met_n_EK[1:min_n]),
           sd_EK = c(r$met_sd_EK[1:min_n] , w$met_sd_EK[1:min_n] ,k$met_sd_EK[1:min_n] ,l1$met_sd_EK[1:min_n] ,
           l2$met_sd_EK[1:min_n] ,  m1$met_sd_EK[1:min_n],  m2$met_sd_EK[1:min_n], c1$met_sd_EK[1:min_n],  c2$met_sd_EK[1:min_n]))



ggplot(data_plot, aes(x = type, y=n)) +
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład pokrycia względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Pokrycie regionu")


ggplot(data_plot, aes(x = type, y=q)) +
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład kwantyli względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Wartość kwantyli")

```






## p = 0.06

```{r}
sym <- readRDS('/home/abrodecka/Pulpit/met/summary_pr_3_0.06.rds')
print(paste0("Ilosc regionów: ", nrow(sym)))

sym$type <- sym$type

ggplot(sym, aes(met_n_EK, group = type, fill=type)) + geom_histogram(bindwidth = 5) + ggtitle('Rozkład pokrycia regionów')  +
  theme_minimal() + xlim(0,150) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Stopień pokrycia",y="Częstość")


 ggplot(sym, aes(met_diff, group = type, fill=type)) + geom_histogram(binwidth = 0.01) + ggtitle('Rozkład różnicy metylacji')  +
  theme_minimal() + xlim(0,0.5) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Różnica metlacji",y="Częstość")


```




### tTest:

```{r}
r <- readRDS('/home/abrodecka/Pulpit/met/tTest_pr_3_0.06.rds')

print(paste0('Ile braków danych: ', r %>% filter(is.na(pValue)) %>% nrow()))


r %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
 left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> r


DT::datatable(r[1:100, -c(1,2,3,5)])


```



### Wilcoxon:

```{r}
w <- readRDS('/home/abrodecka/Pulpit/met/Wilcoxon_pr_3_0.06.rds')

print(paste0('Ile braków danych: ', w %>% filter(is.na(pValue)) %>% nrow()))


w %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> w


DT::datatable(w[1:100, -c(1,2,3,5)])


```



### KSTest:

```{r}
k <- readRDS('/home/abrodecka/Pulpit/met/KS_pr_3_0.06.rds')

print(paste0('Ile braków danych: ', k %>% filter(is.na(pValue)) %>% nrow()))


k %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> k


DT::datatable(k[1:100, -c(1,2,3,5)])


```


### Regresja logistyczna:

```{r}
l <- readRDS('/home/abrodecka/Pulpit/met/Log_reg_pr_3_0.06.rds')

print(paste0('Ile braków danych: ', l %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
l %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
 left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> l1

DT::datatable(l1[1:100, -c(1,2,3,6)])

```

Szeregowane po beta:

```{r}

l %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 100) -> l2

DT::datatable(l2[1:100, -c(1,2,3,6)])

```



### Regresja logistyczna z efektami losowymi:

```{r}
m <- readRDS('/home/abrodecka/Pulpit/met/Mixed_reg_pr_3_0.06.rds')

print(paste0('Ile braków danych: ', m %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
m %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> m1

DT::datatable(m1[1:100, -c(1,2,3,6)])

```

Szeregowane po beta:

```{r}

m %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> m2

DT::datatable(m2[1:100, -c(1,2,3,6)])

```



### Regresja logistyczna z efektami losowymi z uwzględnieniem korelacji:

```{r}
c <- readRDS('/home/abrodecka/Pulpit/met/Corr_reg_pr_3_0.06.rds')

print(paste0('Ile braków danych: ', c %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
c %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> c1

DT::datatable(c1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

c %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
 left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> c2

DT::datatable(c2[1:100, -c(1,2,3,6)])

```



### Podsumowanie

```{r}

venn(list(Ttest=r$prob_name,Wilc=w$prob_name, Log2 = l2$prob_name, Mix2 = m2$prob_name, Corr2 = c2$prob_name))
venn(list(Mix1 = m1$prob_name, Mix2 = m2$prob_name))
venn(list(Corr1 = c1$prob_name, Corr2 = c2$prob_name))
venn(list(Log1=l1$prob_name,Log2 = l2$prob_name))
venn(list(Ttest=r$prob_name,Wilc=w$prob_name,KS=k$prob_name))
```

#### Rozkłady top 1000 każdej z metod

```{r}
min_n = min(c(nrow(r), nrow(w), nrow(k), nrow(l1), nrow(l2), nrow(m1), nrow(m2), nrow(c1), nrow(c2)))
data_plot = data.frame(type = rep(c('Ttest','Wilc','KS','Log1','Log2', 'Mix1', 'Mix2','Corr1', 'Corr2'), each =min_n), q = c(r$quantile[1:min_n],w$quantile[1:min_n],k$quantile[1:min_n],l1$quantile[1:min_n],
           l2$quantile[1:min_n],  m1$quantile[1:min_n],  m2$quantile[1:min_n], c1$quantile[1:min_n],  c2$quantile[1:min_n]),
           n = c(r$met_n_EK[1:min_n] , w$met_n_EK[1:min_n] , k$met_n_EK[1:min_n] , l1$met_n_EK[1:min_n] ,
           l2$met_n_EK[1:min_n] ,  m1$met_n_EK[1:min_n] ,  m2$met_n_EK[1:min_n] , c1$met_n_EK[1:min_n],  c2$met_n_EK[1:min_n]),
           sd_EK = c(r$met_sd_EK[1:min_n] , w$met_sd_EK[1:min_n] ,k$met_sd_EK[1:min_n] ,l1$met_sd_EK[1:min_n] ,
           l2$met_sd_EK[1:min_n] ,  m1$met_sd_EK[1:min_n],  m2$met_sd_EK[1:min_n], c1$met_sd_EK[1:min_n],  c2$met_sd_EK[1:min_n]))



ggplot(data_plot, aes(x = type, y=n)) +
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkad pokrycia względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Pokrycie regionu")


ggplot(data_plot, aes(x = type, y=q)) +
  geom_boxplot(aes(fill=type)) + ggtitle('Rozk?ad kwantyli względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Warto?? kwantyli")

```



## p = 0.08

```{r}
sym <- readRDS('/home/abrodecka/Pulpit/met/summary_pr_3_0.08.rds')
print(paste0("Ilosc region?w: ", nrow(sym)))

sym$type <- sym$type

ggplot(sym, aes(met_n_EK, group = type, fill=type)) + geom_histogram(bindwidth = 5) + ggtitle('Rozkład pokrycia regionów')  +
  theme_minimal() + xlim(0,150) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Stopień pokrycia",y="Częstość")


 ggplot(sym, aes(met_diff, group = type, fill=type)) + geom_histogram(binwidth = 0.01) + ggtitle('Rozkład różnicy metylacji')  +
  theme_minimal() + xlim(0,0.5) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Różnica metlacji",y="Częstość")


```


### tTest:

```{r}
r <- readRDS('/home/abrodecka/Pulpit/met/tTest_pr_3_0.08.rds')

print(paste0('Ile braków danych: ', r %>% filter(is.na(pValue)) %>% nrow()))


r %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> r


DT::datatable(r[1:100, -c(1,2,3,5)])

```



### Wilcoxon:

```{r}
w <- readRDS('/home/abrodecka/Pulpit/met/Wilcoxon_pr_3_0.08.rds')

print(paste0('Ile braków danych: ', w %>% filter(is.na(pValue)) %>% nrow()))


w %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> w


DT::datatable(w[1:100, -c(1,2,3,5)])

```



### KSTest:

```{r}
k <- readRDS('/home/abrodecka/Pulpit/met/KS_pr_3_0.08.rds')

print(paste0('Ile braków danych: ', k %>% filter(is.na(pValue)) %>% nrow()))


k %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> k


DT::datatable(k[1:100, -c(1,2,3,5)])


```



### Regresja logistyczna:

```{r}
l <- readRDS('/home/abrodecka/Pulpit/met/Log_reg_pr_3_0.08.rds')

print(paste0('Ile braków danych: ', l %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
l %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> l1

DT::datatable(l1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

l %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> l2

DT::datatable(l2[1:100, -c(1,2,3,6)])
```



### Regresja logistyczna z efektami losowymi:

```{r}
m <- readRDS('/home/abrodecka/Pulpit/met/Mixed_reg_pr_3_0.08.rds')

print(paste0('Ile braków danych: ', m %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
m %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> m1

DT::datatable(m1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

m %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> m2

DT::datatable(m2[1:100, -c(1,2,3,6)])

```



### Regresja logistyczna z efektami losowymi z uwzględnieniem korelacji:

```{r}
c <- readRDS('/home/abrodecka/Pulpit/met/Corr_reg_pr_3_0.08.rds')

print(paste0('Ile braków danych: ', c %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
c %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> c1

DT::datatable(c1[1:100, -c(1,2,3,6)])

```

Szeregowane po beta:

```{r}

c %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> c2

DT::datatable(c2[1:100, -c(1,2,3,6)])
```



### Podsumowanie

```{r}

venn(list(Ttest=r$prob_name,Wilc=w$prob_name, Log2 = l2$prob_name, Mix2 = m2$prob_name, Corr2 = c2$prob_name))
venn(list(Mix1 = m1$prob_name, Mix2 = m2$prob_name))
venn(list(Corr1 = c1$prob_name, Corr2 = c2$prob_name))
venn(list(Log1=l1$prob_name,Log2 = l2$prob_name))
venn(list(Ttest=r$prob_name,Wilc=w$prob_name,KS=k$prob_name))
```

### Rozkłady top 1000 każdej z metod

```{r}
min_n = min(c(nrow(r), nrow(w), nrow(k), nrow(l1), nrow(l2), nrow(m1), nrow(m2), nrow(c1), nrow(c2)))
data_plot = data.frame(type = rep(c('Ttest','Wilc','KS','Log1','Log2', 'Mix1', 'Mix2','Corr1', 'Corr2'), each =min_n), q = c(r$quantile[1:min_n],w$quantile[1:min_n],k$quantile[1:min_n],l1$quantile[1:min_n],
           l2$quantile[1:min_n],  m1$quantile[1:min_n],  m2$quantile[1:min_n], c1$quantile[1:min_n],  c2$quantile[1:min_n]),
           n = c(r$met_n_EK[1:min_n] , w$met_n_EK[1:min_n] , k$met_n_EK[1:min_n] , l1$met_n_EK[1:min_n] ,
           l2$met_n_EK[1:min_n] ,  m1$met_n_EK[1:min_n] ,  m2$met_n_EK[1:min_n] , c1$met_n_EK[1:min_n],  c2$met_n_EK[1:min_n]),
           sd_EK = c(r$met_sd_EK[1:min_n] , w$met_sd_EK[1:min_n] ,k$met_sd_EK[1:min_n] ,l1$met_sd_EK[1:min_n] ,
           l2$met_sd_EK[1:min_n] ,  m1$met_sd_EK[1:min_n],  m2$met_sd_EK[1:min_n], c1$met_sd_EK[1:min_n],  c2$met_sd_EK[1:min_n]))



ggplot(data_plot, aes(x = type, y=n)) +
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład pokrycia względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Pokrycie regionu")


ggplot(data_plot, aes(x = type, y=q)) +
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład kwantyli względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Wartość kwantyli")

```



## p = 0.1

```{r}
sym <- readRDS('/home/abrodecka/Pulpit/met/summary_pr_3_0.1.rds')
print(paste0("Ilosc regionów: ", nrow(sym)))

sym$type <- sym$type

ggplot(sym, aes(met_n_EK, group = type, fill=type)) + geom_histogram(bindwidth = 5) + ggtitle('Rozkład pokrycia regionów')  +
  theme_minimal() + xlim(0,150) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Stopień pokrycia",y="Częstość")


 ggplot(sym, aes(met_diff, group = type, fill=type)) + geom_histogram(binwidth = 0.01) + ggtitle('Rozk?ad r??nicy metylacji')  +
  theme_minimal() + xlim(0,0.5) + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Różnica metlacji",y="Częstość")


```



### tTest:

```{r}
r <- readRDS('/home/abrodecka/Pulpit/met/tTest_pr_3_0.1.rds')

print(paste0('Ile braków danych: ', r %>% filter(is.na(pValue)) %>% nrow()))


r %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
   left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> r

DT::datatable(r[1:100, -c(1,2,3,5)])

```


### Wilcoxon:

```{r}
w <- readRDS('/home/abrodecka/Pulpit/met/Wilcoxon_pr_3_0.1.rds')

print(paste0('Ile braków danych: ', w %>% filter(is.na(pValue)) %>% nrow()))


w %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> w


DT::datatable(w[1:100, -c(1,2,3,5)])

```


### KSTest:

```{r}
k <- readRDS('/home/abrodecka/Pulpit/met/KS_pr_3_0.1.rds')

print(paste0('Ile braków danych: ', k %>% filter(is.na(pValue)) %>% nrow()))


k %>% filter(!is.na(pValue)) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> k


DT::datatable(k[1:100, -c(1,2,3,5)])

```


### Regresja logistyczna:

```{r}
l <- readRDS('/home/abrodecka/Pulpit/met/Log_reg_pr_3_0.1.rds')

print(paste0('Ile braków danych: ', l %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
l %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> l1

DT::datatable(l1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

l %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
 left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> l2

DT::datatable(l2[1:100, -c(1,2,3,6)])
```


### Regresja logistyczna z efektami losowymi:

```{r}
m <- readRDS('/home/abrodecka/Pulpit/met/Mixed_reg_pr_3_0.1.rds')

print(paste0('Ile braków danych: ', m %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
m %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> m1

DT::datatable(m1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

m %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> m2

DT::datatable(m2[1:100, -c(1,2,3,6)])
```



### Regresja logistyczna z efektami losowymi z uwzględnieniem korelacji:

```{r}
c <- readRDS('/home/abrodecka/Pulpit/met/Corr_reg_pr_3_0.1.rds')

print(paste0('Ile braków danych: ', c %>% filter(is.na(pValue)) %>% nrow()))

```

Szeregowanie po pValue:

```{r}
c %>% filter(!is.na(pValue), abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(pValue) %>% 
  filter(row_number() < 1000) -> c1

DT::datatable(c1[1:100, -c(1,2,3,6)])
```

Szeregowane po beta:

```{r}

c %>% filter(pValue < 0.001, abs(beta)<30) %>% mutate(prob_name = paste0(tiles, '_', no_prob)) %>%
  left_join(sym, on = "prob_name") %>%
  arrange(desc(beta)) %>% 
  filter(row_number() < 1000) -> c2

DT::datatable(c2[1:100, -c(1,2,3,6)])
```



### Podsumowanie

```{r}

venn(list(Ttest=r$prob_name,Wilc=w$prob_name, Log2 = l2$prob_name, Mix2 = m2$prob_name, Corr2 = c2$prob_name))
venn(list(Mix1 = m1$prob_name, Mix2 = m2$prob_name))
venn(list(Corr1 = c1$prob_name, Corr2 = c2$prob_name))
venn(list(Log1=l1$prob_name,Log2 = l2$prob_name))
venn(list(Ttest=r$prob_name,Wilc=w$prob_name,KS=k$prob_name))
```

### Rozkłady top 1000 każdej z metod

```{r}
min_n = min(c(nrow(r), nrow(w), nrow(k), nrow(l1), nrow(l2), nrow(m1), nrow(m2), nrow(c1), nrow(c2)))
data_plot = data.frame(type = rep(c('Ttest','Wilc','KS','Log1','Log2', 'Mix1', 'Mix2','Corr1', 'Corr2'), each =min_n), q = c(r$quantile[1:min_n],w$quantile[1:min_n],k$quantile[1:min_n],l1$quantile[1:min_n],
           l2$quantile[1:min_n],  m1$quantile[1:min_n],  m2$quantile[1:min_n], c1$quantile[1:min_n],  c2$quantile[1:min_n]),
           n = c(r$met_n_EK[1:min_n] , w$met_n_EK[1:min_n] , k$met_n_EK[1:min_n] , l1$met_n_EK[1:min_n] ,
           l2$met_n_EK[1:min_n] ,  m1$met_n_EK[1:min_n] ,  m2$met_n_EK[1:min_n] , c1$met_n_EK[1:min_n],  c2$met_n_EK[1:min_n]),
           sd_EK = c(r$met_sd_EK[1:min_n] , w$met_sd_EK[1:min_n] ,k$met_sd_EK[1:min_n] ,l1$met_sd_EK[1:min_n] ,
           l2$met_sd_EK[1:min_n] ,  m1$met_sd_EK[1:min_n],  m2$met_sd_EK[1:min_n], c1$met_sd_EK[1:min_n],  c2$met_sd_EK[1:min_n]))



ggplot(data_plot, aes(x = type, y=n)) + 
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład pokrycia względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Pokrycie regionu")


ggplot(data_plot, aes(x = type, y=q)) + 
  geom_boxplot(aes(fill=type)) + ggtitle('Rozkład kwantyli względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Metoda",y="Wartość kwantyli")

```

## FDR

```{r}
library(tidyr)
library(ggplot2)
FDR = readRDS('/home/abrodecka/Pulpit/met/FDR.rds')
FDR = data.frame(FDR)
FDR$p <- seq(0.1, 0.02, by = -0.02)
colnames(FDR)[1:9] <- c('tTest', 'wilcoxon','KS', 'log1', 'log2', 'mixed1', 'mixed2', 'corr1', 'corr2') 
FDR = gather(FDR, p)
colnames(FDR)[2] = 'type'
ggplot(FDR, aes(x = p, y = value, group = type, color = type)) + geom_line() + ggtitle('Wielkość FDR względem metod')  +
  theme_minimal()  + theme(title = element_text(size = 20), axis.title = element_text(size = 17),
                                        axis.text = element_text(size = 14)) +
  labs(x="Parametr symulacji",y="FDR")

```

